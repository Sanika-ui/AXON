<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TRAVELMITRA-YOUR PERSONAL MAP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { 
      margin:0; 
      font-family: 'Courier New', Courier, monospace; 
      background-color: rgb(6, 0, 96);
    }

    header { padding:12px; background:rgb(6,0,96); color:white; }
    #map { width:100%; height:500px; }
    .chart-box { 
      width:100%; 
      max-width:800px; 
      margin:12px auto; 
      height:450px;
      background:white; 
      border:1px solid #ddd; 
      border-radius:8px; 
      padding:16px;
      box-sizing: border-box;
    }
    canvas { width:100% !important; height:100% !important; }
    .controls { display:flex; gap:10px; margin-bottom:12px; flex-wrap:wrap; }
    #place { flex:1; padding:8px; }
    #datetime, #mode { padding:8px; border:1px solid #ccc; border-radius:6px; }
    button { padding:8px 12px; background:#0ea5e9; color:white; border:none; border-radius:6px; cursor:pointer; }
    button:hover { background:#0284c7; }
  </style>
</head>
<body>
  <header><h1 style="margin:0;font-size:26px;"> TRAVELMITRA - YOUR ULTIMATE PERSONAL MAP</h1></header>

  <div id="map"></div>

  <div class="chart-box">
    <div class="controls">
      <input id="place" type="text" placeholder="Enter destination" />
      <input id="datetime" type="datetime-local" />
      <select id="mode">
        <option value="car">Car</option>
        <option value="pedestrian">Pedestrian</option>
        <option value="bicycle">Bicycle</option>
        <option value="plane">Plane</option>
        <option value="train">Train</option>
      </select>
      <button onclick="handleSearch()">SEARCH</button>
    </div>
    <canvas id="combinedChart"></canvas>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

  <script>
    const TOMTOM_API_KEY = "Vd6J85v5I2HxVJZwS5tKMQ7ROS4BKAsv";

    const map = L.map('map').setView([28.6139, 77.2090], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    let originCoords = null;
    let originMarker, destMarker, routeLine;
    let combinedChartObj;

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        originCoords = [pos.coords.latitude, pos.coords.longitude];
        originMarker = L.marker(originCoords, { title:"You" }).addTo(map);
        map.setView(originCoords, 13);
      });
    }

    async function geocodePlace(place) {
      const url = `https://api.tomtom.com/search/2/search/${encodeURIComponent(place)}.json?key=${TOMTOM_API_KEY}&limit=1`;
      const res = await fetch(url);
      const data = await res.json();
      if (!data.results || data.results.length === 0) throw new Error("Place not found");
      return [data.results[0].position.lat, data.results[0].position.lon];
    }

    async function fetchRoute(orig, dest, mode) {
      if (["car","pedestrian","bicycle"].includes(mode)) {
        const url = `https://api.tomtom.com/routing/1/calculateRoute/${orig[0]},${orig[1]}:${dest[0]},${dest[1]}/json?key=${TOMTOM_API_KEY}&travelMode=${mode}&traffic=true`;
        const res = await fetch(url);
        const data = await res.json();
        if (!data.routes || data.routes.length === 0) throw new Error("No route found for the selected mode. Try a closer destination or different mode.");
        return { travelTimeInSeconds: data.routes[0].summary.travelTimeInSeconds, points: data.routes[0].legs[0].points };
      } else {
        const R = 6371; 
        const dLat = (dest[0]-orig[0])*Math.PI/180;
        const dLon = (dest[1]-orig[1])*Math.PI/180;
        const a = Math.sin(dLat/2)**2 + Math.cos(orig[0]*Math.PI/180)*Math.cos(dest[0]*Math.PI/180)*Math.sin(dLon/2)**2;
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distanceKm = R * c;

        let travelTimeSec;
        if (mode === "plane") {
            const speedKmh = 800; 
            travelTimeSec = (distanceKm / speedKmh) * 3600;
        } else if (mode === "train") {
            const realisticDistanceKm = distanceKm * 1.4;
            const speedKmh = 55; 
            travelTimeSec = (realisticDistanceKm / speedKmh) * 3600;
        }
        const
